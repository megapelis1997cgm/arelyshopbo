<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalles del Producto - Arelyshop</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .selected-thumbnail {
            border-color: #F97316; /* orange-500 */
        }
        /* Hide scrollbar for clean look */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        .gallery-arrow {
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .group:hover .gallery-arrow {
            opacity: 1;
        }
    </style>
</head>
<body class="bg-gray-100">

    <!-- Header Section -->
    <header class="bg-white py-3 px-4 md:px-8 shadow-md sticky top-0 z-50">
        <div class="container mx-auto">
            <!-- Top Row -->
            <div class="flex items-center justify-between gap-4">
                <a href="index.html" class="text-2xl md:text-3xl font-bold text-orange-600">Arelyshop</a>
                <nav class="hidden lg:flex items-center gap-8">
                    <a href="index.html" class="text-gray-600 hover:text-orange-600 font-semibold transition-colors">Inicio</a>
                    <a href="colecciones.html" class="text-gray-600 hover:text-orange-600 font-semibold transition-colors">Ver Catálogo</a>
                    <a href="https://api.whatsapp.com/send/?phone=59167500044&text&type=phone_number&app_absent=0" target="_blank" class="text-green-500 hover:text-green-600 text-2xl transition-colors" aria-label="WhatsApp">
                        <i class="fa-brands fa-whatsapp"></i>
                    </a>
                </nav>
                <div class="flex items-center gap-4">
                    <a href="#" class="text-gray-600 hover:text-orange-600 transition-colors relative">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
                        <span class="absolute -top-2 -right-2 bg-orange-600 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">3</span>
                    </a>
                    <button id="mobile-menu-button" class="lg:hidden text-gray-600 hover:text-orange-600">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" /></svg>
                    </button>
                </div>
            </div>
            <!-- Search Bar Row -->
            <div class="w-full mt-3">
                 <form id="search-form" class="w-full max-w-2xl mx-auto">
                    <div class="flex">
                        <input id="search-input" type="text" placeholder="Busca en Arelyshop..." class="w-full px-4 py-2 border border-gray-300 rounded-l-md focus:outline-none focus:ring-2 focus:ring-orange-500">
                        <button type="submit" class="bg-orange-600 text-white px-6 py-2 rounded-r-md hover:bg-orange-700 transition-colors">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </button>
                    </div>
                 </form>
            </div>
            <!-- Mobile Menu Dropdown -->
            <div id="mobile-menu" class="hidden lg:hidden mt-4">
                <nav class="flex flex-col gap-4">
                    <a href="index.html" class="text-gray-700 hover:bg-orange-100 p-2 rounded-md font-semibold">Inicio</a>
                    <a href="colecciones.html" class="text-gray-700 hover:bg-orange-100 p-2 rounded-md font-semibold">Ver Catálogo</a>
                    <a href="https://api.whatsapp.com/send/?phone=59167500044&text&type=phone_number&app_absent=0" target="_blank" class="flex items-center gap-2 text-gray-700 hover:bg-orange-100 p-2 rounded-md font-semibold">
                        <i class="fa-brands fa-whatsapp text-green-500 text-lg"></i> WhatsApp
                    </a>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto p-4 md:p-8">
        <div id="product-details-container" class="bg-white rounded-lg shadow-lg p-4 md:p-8">
            <p class="text-center text-gray-500">Cargando detalles del producto...</p>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-4 md:p-8 mt-8">
            <div class="border-b border-gray-200">
                <nav class="flex gap-6" id="tab-nav">
                    <button data-tab="description" class="tab-btn py-4 px-1 text-orange-600 border-b-2 border-orange-600 font-semibold">Descripción</button>
                    <button data-tab="reviews" class="tab-btn py-4 px-1 text-gray-500 font-semibold">Opiniones</button>
                </nav>
            </div>
            <div class="py-6">
                <div id="description-content" class="tab-content text-gray-700 leading-relaxed">
                    <p>Cargando descripción...</p>
                </div>
                <div id="reviews-content" class="tab-content hidden">
                    <p>Aún no hay opiniones para este producto.</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white mt-12">
        <div class="container mx-auto px-8 py-10">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-8">
                <div>
                    <h4 class="font-bold text-lg mb-4">Atención al Cliente</h4>
                    <ul><li class="mb-2"><a href="#" class="text-gray-300 hover:text-orange-400 transition-colors">Centro de Ayuda</a></li><li class="mb-2"><a href="#" class="text-gray-300 hover:text-orange-400 transition-colors">Políticas y Reglas</a></li><li class="mb-2"><a href="#" class="text-gray-300 hover:text-orange-400 transition-colors">Contactar</a></li></ul>
                </div>
                <div>
                    <h4 class="font-bold text-lg mb-4">Compra con Nosotros</h4>
                    <ul><li class="mb-2"><a href="#" class="text-gray-300 hover:text-orange-400 transition-colors">Realizar un Pedido</a></li><li class="mb-2"><a href="#" class="text-gray-300 hover:text-orange-400 transition-colors">Métodos de Pago</a></li><li class="mb-2"><a href="#" class="text-gray-300 hover:text-orange-400 transition-colors">Protección del Comprador</a></li></ul>
                </div>
                <div>
                    <h4 class="font-bold text-lg mb-4">Colabora con Nosotros</h4>
                    <ul><li class="mb-2"><a href="#" class="text-gray-300 hover:text-orange-400 transition-colors">Vende en Arelyshop</a></li><li class="mb-2"><a href="#" class="text-gray-300 hover:text-orange-400 transition-colors">Programa de Afiliados</a></li></ul>
                </div>
                <div>
                    <h4 class="font-bold text-lg mb-4">Síguenos</h4>
                    <div class="flex gap-5 text-xl">
                        <a href="https://www.facebook.com/arelyshopbo" target="_blank" class="text-gray-300 hover:text-orange-400 transition-colors" aria-label="Facebook"><i class="fa-brands fa-facebook-f"></i></a>
                        <a href="https://www.tiktok.com/@arelyshopbo" target="_blank" class="text-gray-300 hover:text-orange-400 transition-colors" aria-label="TikTok"><i class="fa-brands fa-tiktok"></i></a>
                        <a href="https://www.instagram.com/arelyshopbo" target="_blank" class="text-gray-300 hover:text-orange-400 transition-colors" aria-label="Instagram"><i class="fa-brands fa-instagram"></i></a>
                        <a href="https://api.whatsapp.com/send/?phone=59167500044&text&type=phone_number&app_absent=0" target="_blank" class="text-gray-300 hover:text-orange-400 transition-colors" aria-label="WhatsApp"><i class="fa-brands fa-whatsapp"></i></a>
                    </div>
                </div>
            </div>
            <div class="mt-10 pt-8 border-t border-gray-700 text-center text-gray-400 text-sm">
                <p>&copy; <span id="footer-year"></span> Arelyshop. Todos los derechos reservados.</p>
            </div>
        </div>
    </footer>


    <script>
        // Mobile Menu Toggle
        document.getElementById('mobile-menu-button').addEventListener('click', () => {
            document.getElementById('mobile-menu').classList.toggle('hidden');
        });
        
        // Set current year in footer
        document.getElementById('footer-year').textContent = new Date().getFullYear();
        
        // Search form handler
        document.getElementById('search-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const searchTerm = document.getElementById('search-input').value;
            if (searchTerm.trim()) {
                const url = new URL('colecciones.html', window.location.href);
                url.searchParams.set('search', searchTerm.trim());
                window.location.href = url.href;
            }
        });

        // --- DATA FETCHING AND DISPLAY ---
        document.addEventListener('DOMContentLoaded', () => {
            const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTwnLFgBw30tyAFXc2olw5LLnqQdaxMRiZSpSndWSWhslTkqATarBs8dLImUhcXLK8EmBEs7gUL10oK/pub?output=csv';
            const container = document.getElementById('product-details-container');
            
            const params = new URLSearchParams(window.location.search);
            const productId = params.get('id');

            if (productId === null) {
                container.innerHTML = '<h1 class="text-2xl font-bold text-center text-red-600">Producto no encontrado.</h1><p class="text-center">Por favor, selecciona un producto desde la página de inicio.</p>';
                return;
            }

            fetch(csvUrl)
              .then(response => response.text())
              .then(text => {
                const products = parseCSV(text);
                const product = products.find(p => p.id == productId);
                if (product) {
                    displayProductDetails(product);
                } else {
                    container.innerHTML = '<h1 class="text-2xl font-bold text-center text-red-600">Producto no encontrado.</h1>';
                }
              })
              .catch(error => {
                console.error('Error fetching product data:', error);
                container.innerHTML = '<h1 class="text-2xl font-bold text-center text-red-600">No se pudo cargar el producto.</h1>';
              });
        });

        function parseCSV(text) {
            const lines = text.trim().split(/\r\n|\n/);
            const headers = lines[0].split(',').map(h => h.trim().toLowerCase());
            
            return lines.slice(1).map((line, index) => {
                if (line.trim() === '') return null;
                
                const values = line.split(',');
                const product = {};

                for (let i = 0; i < headers.length; i++) {
                    product[headers[i]] = values[i] ? values[i].trim() : '';
                }

                product.id = index;
                return product;
            }).filter(Boolean);
        }

        function displayProductDetails(product) {
            const container = document.getElementById('product-details-container');
            const name = product.nombre || 'Producto sin nombre';
            const price = product.precio || 'N/A';
            const wholesalePrice = product.mayoreo || 'N/A';
            const description = product.description || 'No hay descripción disponible para este producto.';
            
            const photoUrls = [];
            for (let i = 1; i <= 6; i++) {
                if (product[`foto ${i}`]) {
                    photoUrls.push(product[`foto ${i}`]);
                }
            }

            document.title = `${name} - Arelyshop`;

            container.innerHTML = `
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div id="gallery-container">
                        <!-- Gallery will be generated by JS -->
                    </div>
                    <div>
                        <h1 class="text-2xl md:text-3xl font-bold text-gray-800 mb-2">${name}</h1>
                        <div class="flex items-center mb-4">
                            <span class="text-yellow-400 text-lg">★★★★☆</span>
                            <a href="#reviews" class="text-sm text-gray-500 ml-2 hover:text-orange-600">Ver valoraciones</a>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg mb-4">
                            <div class="flex items-baseline gap-2">
                                <p class="text-3xl font-bold text-orange-600">Bs. ${price}</p>
                                <p class="text-md text-gray-500">por unidad</p>
                            </div>
                            <p class="text-xl font-semibold text-green-600 mt-1">
                                <span>Bs. ${wholesalePrice}</span>
                                <span class="text-md text-gray-500">por mayoreo</span>
                            </p>
                        </div>
                        <div class="mb-6">
                            <h3 class="text-md font-semibold text-gray-700 mb-2">Cantidad</h3>
                            <div class="flex items-center">
                                <button id="decrease-quantity" class="bg-gray-200 text-gray-700 h-10 w-10 rounded-l-md font-bold text-xl hover:bg-gray-300">-</button>
                                <input id="quantity-input" type="text" value="1" class="w-16 h-10 text-center border-t border-b border-gray-200 focus:outline-none">
                                <button id="increase-quantity" class="bg-gray-200 text-gray-700 h-10 w-10 rounded-r-md font-bold text-xl hover:bg-gray-300">+</button>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <button class="w-full bg-orange-200 text-orange-800 font-bold py-3 rounded-lg hover:bg-orange-300 transition-colors">Añadir a la cesta</button>
                            <button class="w-full bg-orange-600 text-white font-bold py-3 rounded-lg hover:bg-orange-700 transition-colors">Comprar ahora</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('description-content').innerHTML = `<p>${description.replace(/\n/g, '</p><p>')}</p>`;
            generateImageGallery(photoUrls, name);
            addEventListeners();
        }
        
        function generateImageGallery(photoUrls, productName) {
            const galleryContainer = document.getElementById('gallery-container');
            const placeholderUrl = `https://placehold.co/600x600/E0E0E0/757575?text=${encodeURIComponent(productName)}`;

            if (photoUrls.length === 0) {
                galleryContainer.innerHTML = `
                    <div class="mb-4">
                        <img id="main-image" src="${placeholderUrl}" alt="Imagen de ${productName}" class="w-full aspect-square object-cover rounded-lg shadow-md">
                    </div>`;
                return;
            }

            const mainImageUrl = photoUrls[0];
            
            let thumbnailsHTML = photoUrls.map((url, index) => {
                const thumbPlaceholder = `https://placehold.co/100x100/E0E0E0/757575?text=${index + 1}`;
                const isSelected = index === 0 ? 'selected-thumbnail' : '';
                return `<img src="${url}" onerror="this.onerror=null;this.src='${thumbPlaceholder}';" alt="Miniatura ${index + 1}" class="thumbnail w-1/5 cursor-pointer rounded-md border-2 border-transparent ${isSelected}" onclick="changeImage(this, ${index})">`;
            }).join('');

            galleryContainer.innerHTML = `
                <div class="mb-4 relative group">
                    <img id="main-image" src="${mainImageUrl}" onerror="this.onerror=null;this.src='${placeholderUrl}';" alt="Imagen principal de ${productName}" class="w-full aspect-square object-cover rounded-lg shadow-md cursor-pointer">
                    <button id="gallery-prev-btn" class="gallery-arrow absolute left-3 top-1/2 -translate-y-1/2 bg-white/50 rounded-full h-10 w-10 flex items-center justify-center shadow-md z-10 text-xl text-gray-800 hover:bg-white/80"><i class="fa-solid fa-chevron-left"></i></button>
                    <button id="gallery-next-btn" class="gallery-arrow absolute right-3 top-1/2 -translate-y-1/2 bg-white/50 rounded-full h-10 w-10 flex items-center justify-center shadow-md z-10 text-xl text-gray-800 hover:bg-white/80"><i class="fa-solid fa-chevron-right"></i></button>
                </div>
                <div class="relative">
                    <div id="thumbnail-wrapper" class="overflow-x-auto whitespace-nowrap scroll-smooth scrollbar-hide flex gap-2 cursor-grab">
                        ${thumbnailsHTML}
                    </div>
                </div>
            `;
            
            setupGalleryNavigation(photoUrls);
        }

        let currentIndex = 0;
        function changeImage(thumbnailElement, index) {
            currentIndex = index;
            const mainImage = document.getElementById('main-image');
            mainImage.src = thumbnailElement.src;
            
            mainImage.onerror = function() {
                this.onerror=null;
                this.src=`https://placehold.co/600x600/E0E0E0/757575?text=Error`;
            };

            document.querySelectorAll('.thumbnail').forEach(thumb => {
                thumb.classList.remove('selected-thumbnail');
            });
            thumbnailElement.classList.add('selected-thumbnail');
        }

        function setupGalleryNavigation(photoUrls) {
            const mainImage = document.getElementById('main-image');
            const prevBtn = document.getElementById('gallery-prev-btn');
            const nextBtn = document.getElementById('gallery-next-btn');
            const thumbWrapper = document.getElementById('thumbnail-wrapper');
            
            if(!mainImage || !prevBtn || !nextBtn || !thumbWrapper) return;

            const updateGallery = () => {
                mainImage.src = photoUrls[currentIndex];
                const thumbnails = document.querySelectorAll('.thumbnail');
                thumbnails.forEach((thumb, index) => {
                    thumb.classList.toggle('selected-thumbnail', index === currentIndex);
                });
                thumbnails[currentIndex].scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
            };

            prevBtn.addEventListener('click', () => {
                currentIndex = (currentIndex > 0) ? currentIndex - 1 : photoUrls.length - 1;
                updateGallery();
            });
            
            nextBtn.addEventListener('click', () => {
                currentIndex = (currentIndex < photoUrls.length - 1) ? currentIndex + 1 : 0;
                updateGallery();
            });

            // Swipe/Drag functionality for main image
            let isDown = false;
            let startX = 0;

            const handleSwipe = (endX) => {
                if (endX < startX - 50) { nextBtn.click(); }
                if (endX > startX + 50) { prevBtn.click(); }
            };

            mainImage.addEventListener('touchstart', (e) => { startX = e.changedTouches[0].screenX; }, { passive: true });
            mainImage.addEventListener('touchend', (e) => { handleSwipe(e.changedTouches[0].screenX); });
            mainImage.addEventListener('mousedown', (e) => { isDown = true; startX = e.pageX; e.preventDefault(); });
            mainImage.addEventListener('mouseup', (e) => { isDown = false; handleSwipe(e.pageX); });
            mainImage.addEventListener('mouseleave', () => { isDown = false; });

            // Drag/Swipe for thumbnails
            let isThumbDown = false;
            let thumbStartX;
            let thumbScrollLeft;

            thumbWrapper.addEventListener('mousedown', (e) => {
                isThumbDown = true;
                thumbWrapper.classList.add('cursor-grabbing');
                thumbStartX = e.pageX - thumbWrapper.offsetLeft;
                thumbScrollLeft = thumbWrapper.scrollLeft;
            });
            thumbWrapper.addEventListener('mouseleave', () => { isThumbDown = false; thumbWrapper.classList.remove('cursor-grabbing'); });
            thumbWrapper.addEventListener('mouseup', () => { isThumbDown = false; thumbWrapper.classList.remove('cursor-grabbing'); });
            thumbWrapper.addEventListener('mousemove', (e) => {
                if(!isThumbDown) return;
                e.preventDefault();
                const x = e.pageX - thumbWrapper.offsetLeft;
                const walk = (x - thumbStartX) * 2;
                thumbWrapper.scrollLeft = thumbScrollLeft - walk;
            });
        }

        function addEventListeners() {
            const quantityInput = document.getElementById('quantity-input');
            if (quantityInput) {
                document.getElementById('increase-quantity').addEventListener('click', () => {
                    quantityInput.value = parseInt(quantityInput.value) + 1;
                });
                document.getElementById('decrease-quantity').addEventListener('click', () => {
                    const currentValue = parseInt(quantityInput.value);
                    if (currentValue > 1) {
                        quantityInput.value = currentValue - 1;
                    }
                });
            }
        }

        // Tabs
        const tabButtons = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                const tabId = button.dataset.tab + '-content';
                tabButtons.forEach(btn => {
                    btn.classList.remove('text-orange-600', 'border-orange-600');
                    btn.classList.add('text-gray-500');
                });
                button.classList.add('text-orange-600', 'border-orange-600');
                button.classList.remove('text-gray-500');
                tabContents.forEach(content => {
                    content.id === tabId ? content.classList.remove('hidden') : content.classList.add('hidden');
                });
            });
        });
    </script>
</body>
</html>
